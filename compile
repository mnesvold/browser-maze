#!/bin/bash

BIN=./node_modules/.bin
SRC=./src
BUILD=./build

log() {
    echo "$1"
}

clean() {
    log 'Removing build directory'
    rm -rf $BUILD
}

lint() {
    log 'Linting CoffeeScript'
    $BIN/coffeelint --quiet `find $SRC -regex '.*\.coffee'`
}

compile() {
    log 'Compiling and bundling CoffeeScript'
    mkdir -p $BUILD
    $BIN/browserify $SRC/scripts/app.coffee \
        -t coffeeify --extension=".coffee" \
        -o $BUILD/maze.js
}

copy_static() {
    log 'Copying static files'
    mkdir -p $BUILD
    cp $SRC/map.html $SRC/maze.html $BUILD
}

case "$1" in
    clean)
        clean
        ;;
    lint)
        lint
        ;;
    compile)
        compile
        ;;
    "")
        lint
        compile
        copy_static
        ;;
    *)
        echo "Usage: $0 (compile|lint|clean)"
        exit 1
esac
